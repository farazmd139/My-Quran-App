<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>القرآن الكريم - Faraz AI</title>
    <meta name="theme-color" content="#161b22"/>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.png" type="image/png">
    
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Noto+Nastaliq+Urdu:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <style>
        :root {
            --glow-color1: #0ebeff; --glow-color2: #ffdd40;
            --glow-color3: #ff4971; --glow-color4: #25d366;
            --highlight-glow: #f39c12;
            --chat-bg: #1e2732;
            --chat-header-bg: #161b22;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Amiri', serif; background-color: #0d121a;
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0);
            background-size: 25px 25px; animation: background-pan 50s linear infinite;
            margin: 0; padding: 20px; direction: rtl; overflow-x: hidden;
            color: #ecf0f1;
        }
        @keyframes background-pan { from { background-position: 0% 0%; } to { background-position: 100% 100%; } }

        .page { display: none; animation: pageFadeIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes pageFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Homescreen --- */
        .home-header { text-align: center; margin-bottom: 30px; }
        .home-header h1 { font-size: 3.5rem; color: var(--highlight-glow); text-shadow: 0 0 10px var(--highlight-glow); margin: 0; font-family: 'Noto Nastaliq Urdu'; }
        .home-header p { font-size: 1.2rem; opacity: 0.8; margin-top: 5px; }
        #surah-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; list-style: none; padding: 0; }
        .surah-list-item { background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; cursor: pointer; transition: background-color 0.3s, transform 0.3s; display: flex; align-items: center; justify-content: space-between; }
        .surah-list-item:hover { background-color: rgba(255,255,255,0.1); transform: translateY(-5px); }
        .surah-info { display: flex; align-items: center; }
        .surah-number { background-color: rgba(0,0,0,0.2); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 5px; margin-left: 15px; font-size: 1rem; font-weight: bold; }
        .surah-name-details h3 { margin: 0; font-size: 1.5rem; font-family: 'Noto Nastaliq Urdu'; }
        .surah-name-details p { margin: 0; opacity: 0.7; font-size: 0.9rem; }
        .surah-arabic-name { font-size: 1.8rem; font-family: 'Amiri', serif; }
        
        /* --- Surah Page --- */
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 3.5rem; color: #ecf0f1; text-shadow: 0px 2px 5px rgba(0,0,0,0.5); font-weight: 700; }
        .surah-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; perspective: 1500px; padding-top: 20px; }
        @keyframes box-color-change { 0%, 100% { background: linear-gradient(145deg, #2980b9, #3498db); } 16.6% { background: linear-gradient(145deg, #8e44ad, #9b59b6); } 33.3% { background: linear-gradient(145deg, #16a085, #1abc9c); } 50% { background: linear-gradient(145deg, #d35400, #e67e22); } 66.6% { background: linear-gradient(145deg, #c0392b, #e74c3c); } 83.3% { background: linear-gradient(145deg, #2c3e50, #34495e); } }
        .ayah-box { padding: 40px 30px; border-radius: 20px; color: #fff; box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3); border: 2px solid transparent; display: flex; align-items: center; justify-content: center; opacity: 1; transition: transform 0.6s ease-out, border-color 0.4s ease; animation: box-color-change 18s linear infinite; }
        .ayah-box.active { border-color: var(--glow-color2); transform: scale(1.02); }
        .ayah-text { font-family: 'Amiri', serif; font-size: 2.2rem; line-height: 2.9; text-align: center; font-weight: 700; text-shadow: 0px 1px 1px rgba(0,0,0,0.2), 0px 2px 2px rgba(0,0,0,0.4), 0px 4px 6px rgba(0,0,0,0.4); animation: color-cycle 20s linear infinite; }
        @keyframes color-cycle { 0% { color: #ffffff; } 25% { color: #d1eaff; } 50% { color: #e0ffed; } 75% { color: #fff5d6; } 100% { color: #ffffff; } }
        .ayah-number { display: inline-block; font-size: 1.5rem; padding-right: 15px; opacity: 0.7; }
        .back-button { position: fixed; top: 20px; left: 20px; padding: 12px 20px; background-color: #ecf0f1; color: #2c3e50; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-family: 'Noto Nastaliq Urdu', sans-serif; }
        #audio-player-container { position: sticky; top: 10px; z-index: 100; padding: 10px; margin-bottom: 20px; background: rgba(13, 18, 26, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px; }
        #audio-player-container audio { width: 100%; }
        
        /* --- Floating Action Buttons & Modals --- */
        .fab-container { position: fixed; bottom: 20px; right: 20px; z-index: 1001; display: flex; flex-direction: column; gap: 15px; }
        .fab { width: 60px; height: 60px; color: white; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 20px rgba(0,0,0,0.4); cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; }
        .fab:hover { transform: scale(1.1); }
        #ai-tutor-button { background: linear-gradient(45deg, var(--glow-color4), var(--glow-color2)); }
        #ai-tutor-button:hover { box-shadow: 0 8px 25px rgba(37, 211, 102, 0.5); }
        #ai-chat-button { background: linear-gradient(45deg, var(--glow-color1), var(--glow-color3)); }
        #ai-chat-button:hover { box-shadow: 0 8px 25px rgba(255, 73, 113, 0.5); }
        .fab .material-symbols-outlined { font-size: 32px; transition: transform 0.5s ease-in-out; }
        .fab:hover .material-symbols-outlined { transform: rotate(360deg); }
        #settings-icon { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; background-color: rgba(44, 62, 80, 0.5); border-radius: 50%; cursor: pointer; transition: background-color 0.3s, transform 0.3s; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        #settings-icon:hover { background-color: rgba(44, 62, 80, 0.9); transform: rotate(45deg); }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); align-items: center; justify-content: center; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background-color: #1e2732; border: 1px solid rgba(255, 255, 255, 0.2); padding: 25px 30px; border-radius: 15px; width: 90%; max-width: 500px; text-align: right; position: relative; animation: modal-fade-in 0.5s; font-family: 'Noto Nastaliq Urdu', sans-serif; direction: rtl; }
        @keyframes modal-fade-in { from {opacity: 0; transform: scale(0.9);} to {opacity: 1; transform: scale(1);} }
        .close-button { color: #aaa; position: absolute; top: 10px; left: 20px; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.2s, transform 0.2s; }
        .close-button:hover { color: white; transform: rotate(90deg); }
        .modal-content h2 { color: var(--highlight-glow); text-align: center; }
        .modal-content p { line-height: 1.8; color: #ccc; text-align: center; }
        .modal-content a { color: var(--glow-color1); text-decoration: none; display: block; padding: 10px; transition: color 0.2s; }
        .credits-section { margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); text-align: right;}
        .credits-section p { margin: 8px 0; text-align: right; }
        .chat-container { width: 95%; max-width: 500px; height: 85%; background-color: var(--chat-bg); border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); display: flex; flex-direction: column; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); animation: zoomIn 0.3s ease forwards; }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .chat-header { padding: 20px; background-color: var(--chat-header-bg); color: white; text-align: center; font-size: 1.5rem; font-family: 'Noto Nastaliq Urdu', sans-serif; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; display: flex; justify-content: center; align-items: center; }
        .chat-header .material-symbols-outlined { margin-right: 10px; color: var(--glow-color2); font-size: 2rem; }
        .chat-messages { flex-grow: 1; padding: 15px; overflow-y: auto; direction: rtl; display: flex; flex-direction: column; gap: 15px; }
        .message { padding: 12px 18px; border-radius: 20px; max-width: 85%; line-height: 1.7; font-family: 'Noto Nastaliq Urdu', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1.1rem; color: #e0e0e0; position: relative; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .user-message { background-color: #2a3b47; align-self: flex-start; margin-right: auto; border-bottom-left-radius: 5px; animation: slideInLeft 0.3s ease forwards; }
        .ai-message { background-color: #323d49; align-self: flex-end; margin-left: auto; border-bottom-right-radius: 5px; animation: slideInRight 0.3s ease forwards; }
        @keyframes slideInRight { from { transform: translateX(-50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .typing-indicator { display: flex; align-items: center; gap: 5px; }
        .typing-indicator span { width: 8px; height: 8px; background-color: #aaa; border-radius: 50%; animation: typing 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .chat-input-area { display: flex; padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); background-color: var(--chat-header-bg); }
        #chat-input { flex-grow: 1; padding: 12px 20px; border-radius: 25px; border: 1px solid #444; font-size: 1rem; background-color: #323d49; color: white; transition: border-color 0.2s; font-family: 'Noto Nastaliq Urdu', sans-serif; direction: rtl; }
        #chat-input:focus { outline: none; border-color: var(--glow-color1); }
        #send-chat-button { width: 50px; height: 50px; margin-right: 10px; border-radius: 50%; border: none; background-color: var(--glow-color1); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; }
        #send-chat-button:hover { background-color: #0b9dcc; }
    </style>
</head>
<body>

    <div id="homePage" class="page active">
        <div class="home-header">
            <h1>القرآن الكريم</h1>
            <p>اپنے پسندیدہ قاری کی تلاوت سنیں</p>
        </div>
        <ul id="surah-list"></ul>
    </div>
    
    <div id="surahPage" class="page">
        <button class="back-button" onclick="showPage('homePage')">⇦ تمام سورتیں</button>
        <header id="surahHeader" class="header"></header>
        <div id="audio-player-container"><audio id="mainAudioPlayer" controls preload="metadata"></audio></div>
        <main id="surahContainer" class="surah-container"></main>
    </div>

    <div id="settings-icon"><span class="material-symbols-outlined">settings</span></div>
    
    <div class="fab-container">
        <button id="ai-tutor-button" class="fab"><span class="material-symbols-outlined">mic</span></button>
        <button id="ai-chat-button" class="fab"><span class="material-symbols-outlined">smart_toy</span></button>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('settings-modal')">×</span>
            <h2>ترتیبات (Settings)</h2>
            <div class="credits-section" style="text-align: center;">
                <p><a href="#" onclick="openModal('credits-modal'); return false;">ہمارے بارے میں اور شکریہ</a></p>
                <p><a href="https://telegra.ph/Privacy-Policy-for-%D8%A7%D9%84%D9%82%D8%B1%D8%A2%D9%86-%D8%A7%D9%84%D9%83%D8%B1%D9%8A%D9%85---Faraz-AI-08-01" target="_blank">پرائیویسی پالیسی</a></p>
                <p><a href="#" id="rate-app-link">ہمیں ریٹنگ دیں</a></p>
                <p><a href="#" id="share-app-link">ایپ شیئر کریں</a></p>
            </div>
        </div>
    </div>
    <div id="credits-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('credits-modal')">×</span>
            <h2>ہمارے بارے میں اور شکریہ</h2>
            <p style="text-align: right;">یہ ایپ قرآن کی تعلیم کو آسان اور جدید طریقے سے سب تک پہنچانے کے نیک ارادے سے بنائی گئی ہے۔</p>
            <div class="credits-section">
                <p><b>قرآنی متن اور API:</b> قرآن کا عربی متن اور سورہ کی معلومات <a href="https://quran.com" target="_blank">Quran.com</a> کی API سے حاصل کی گئی ہیں۔ ہم ان کی شاندار اور مفت خدمت کے لئے ان کے بہت شکر گزار ہیں۔</p>
                <p><b>آڈیو تلاوت:</b> اس ایپ میں استعمال ہونے والی تلاوت قاری <b>مشاری راشد العفاسی</b> کی ہے۔ آڈیو فائلیں Quran.com API کے ذریعے حاصل کی گئی ہیں۔</p>
                <p><b>AI اسسٹنٹ "فراز":</b> اسلامی سوالات کے جوابات دینے کے لئے <b>Google's Gemini AI</b> ماڈل کا استعمال کیا گیا ہے۔</p>
            </div>
        </div>
    </div>
    <div id="coming-soon-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('coming-soon-modal')">×</span>
            <h2 style="font-size: 2.5rem;">✨ جلد آرہا ہے ✨</h2>
            <p>ہم ایک نئے اور انقلابی فیچر پر کام کر رہے ہیں - **AI تلاوت ٹیوٹر**!</p>
            <p>جلد ہی آپ اپنی تلاوت ریکارڈ کر سکیں گے اور ہمارا AI آپ کو بتائے گا کہ آپ کی غلطیاں کہاں ہیں اور تجوید کو کیسے بہتر بنایا جائے۔ دیکھتے رہیں!</p>
        </div>
    </div>
    <div id="ai-chat-modal" class="modal">
        <div class="chat-container">
            <div class="chat-header">
                <span class="close-button" id="close-chat-button">×</span>
                فراز
                <span class="material-symbols-outlined">neurology</span>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai-message">السلام علیکم! میرا نام فراز ہے۔ میں آپ کے سوالات کا جواب دینے کے لیے حاضر ہوں۔</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="یہاں سوال لکھیں...">
                <button id="send-chat-button"><span class="material-symbols-outlined">send</span></button>
            </div>
        </div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyDB4TUj3zsU90jCfI8L0yivvWIYipUtq3c';

        // --- DOM Elements ---
        const pages = document.querySelectorAll('.page');
        const surahList = document.getElementById('surah-list');
        const surahHeader = document.getElementById('surahHeader');
        const surahContainer = document.getElementById('surahContainer');
        const mainAudioPlayer = document.getElementById('mainAudioPlayer');
        
        // --- Page Navigation ---
        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'homePage') {
                mainAudioPlayer.pause();
                mainAudioPlayer.src = '';
            }
        }
        
        // --- Fetch and Display Surah List ---
        async function fetchSurahList() {
            try {
                const response = await fetch('https://api.quran.com/api/v4/chapters');
                const data = await response.json();
                displaySurahs(data.chapters);
            } catch (error) {
                surahList.innerHTML = '<p style="color: white; text-align: center;">سورہ کی فہرست لوڈ کرنے میں ناکامی।</p>';
                console.error("Error fetching surah list:", error);
            }
        }

        function displaySurahs(surahs) {
            surahList.innerHTML = '';
            surahs.forEach(surah => {
                const listItem = document.createElement('li');
                listItem.className = 'surah-list-item';
                listItem.dataset.surahId = surah.id;
                listItem.innerHTML = `
                    <div class="surah-info">
                        <span class="surah-number">${surah.id}</span>
                        <div class="surah-name-details">
                            <h3>${surah.name_simple}</h3>
                            <p>${surah.translated_name.name} - ${surah.verses_count} آیات</p>
                        </div>
                    </div>
                    <span class="surah-arabic-name">${surah.name_arabic}</span>
                `;
                listItem.addEventListener('click', () => loadSurah(surah.id));
                surahList.appendChild(listItem);
            });
        }

        // --- Load and Display a Single Surah ---
        async function loadSurah(surahId) {
            showPage('surahPage');
            surahHeader.innerHTML = '<h1>لوڈ ہو رہا ہے...</h1>';
            surahContainer.innerHTML = '';
            
            try {
                const [versesRes, infoRes, audioRes] = await Promise.all([
                    fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?chapter_number=${surahId}`),
                    fetch(`https://api.quran.com/api/v4/chapters/${surahId}`),
                    fetch(`https://api.quran.com/api/v4/chapter_recitations/7/${surahId}`)
                ]);

                const versesData = await versesRes.json();
                const infoData = await infoRes.json();
                const audioData = await audioRes.json();

                const surahInfo = infoData.chapter;
                surahHeader.innerHTML = `
                    ${surahInfo.bismillah_pre ? '<h1>بِسْمِ اللّٰهِ الرَّحْمٰنِ الرَّحِيْمِ</h1>' : ''}
                    <h1>${surahInfo.name_arabic}</h1>
                `;
                
                mainAudioPlayer.src = audioData.audio_file.audio_url;

                versesData.verses.forEach((ayah, index) => {
                    const box = document.createElement('div');
                    box.className = 'ayah-box';
                    box.innerHTML = `<p class="ayah-text">${ayah.text_uthmani}<span class="ayah-number">${index + 1}</span></p>`;
                    box.style.animationDelay = `-${index * 1.5}s`;
                    surahContainer.appendChild(box);
                });

            } catch (error) {
                surahHeader.innerHTML = '<h1>سورہ لوڈ کرنے میں ناکامی</h1>';
                console.error("Error loading surah:", error);
            }
        }

        // --- AI Chat JavaScript ---
        const chatButton = document.getElementByI
